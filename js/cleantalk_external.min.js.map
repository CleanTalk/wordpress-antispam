{"version":3,"file":"cleantalk_external.min.js","sources":["cleantalk_external.js"],"sourcesContent":["/**\n * Handle external forms\n */\nfunction ct_protect_external() {\n\tfor(let i = 0; i < document.forms.length; i++) {\n\n\t\tif (document.forms[i].cleantalk_hidden_action === undefined && document.forms[i].cleantalk_hidden_method === undefined) {\n\n            // current form\n            let currentForm = document.forms[i];\n\n\t\t\tif(typeof(currentForm.action) == 'string') {\n\n\t\t\t\tif(isIntegratedForm(currentForm)) {\n\t\t\t\t\tjQuery( currentForm ).before('<i class=\"cleantalk_placeholder\" style=\"display: none;\"></i>');\n\n\t\t\t\t\t// Deleting form to prevent submit event\n\t\t\t\t\tlet prev = jQuery(currentForm).prev(),\n\t\t\t\t\t\tform_html = currentForm.outerHTML,\n\t\t\t\t\t\tform_original = jQuery(currentForm).detach();\n\n\t\t\t\t\tprev.after( form_html );\n\n\t\t\t\t\tlet force_action = document.createElement(\"input\");\n\t\t\t\t\tforce_action.name = 'action';\n\t\t\t\t\tforce_action.value = 'cleantalk_force_ajax_check';\n\t\t\t\t\tforce_action.type = 'hidden';\n\n                    let reUseCurrentForm = document.forms[i];\n\n                    reUseCurrentForm.appendChild(force_action);\n\n                    // mailerlite integration - disable click on submit button\n                    if(reUseCurrentForm.classList !== undefined && reUseCurrentForm.classList.contains('ml-block-form')) {\n                        const mailerliteSubmitButton = jQuery('form.ml-block-form').find('button[type=\"submit\"]');\n\n                        if(mailerliteSubmitButton !== undefined) {\n                            mailerliteSubmitButton.click(function (event) {\n                                event.preventDefault();\n                                sendAjaxCheckingFormData(reUseCurrentForm, prev, form_original);\n                            });\n                        }\n                    } else {\n                        document.forms[i].onsubmit = function ( event ){\n\n                            event.preventDefault();\n\n                            sendAjaxCheckingFormData(reUseCurrentForm, prev, form_original);\n                        };\n                    }\n\n\t\t\t\t// Common flow\n\t\t\t\t}else if(currentForm.action.indexOf('http://') !== -1 || currentForm.action.indexOf('https://') !== -1) {\n\n\t\t\t\t\tvar tmp = currentForm.action.split('//');\n\t\t\t\t\ttmp = tmp[1].split('/');\n\t\t\t\t\tvar host = tmp[0].toLowerCase();\n\n\t\t\t\t\tif(host !== location.hostname.toLowerCase()){\n\n\t                    var ct_action = document.createElement(\"input\");\n\t                    ct_action.name = 'cleantalk_hidden_action';\n\t\t\t\t\t\tct_action.value = currentForm.action;\n\t\t\t\t\t\tct_action.type = 'hidden';\n                        currentForm.appendChild(ct_action);\n\n\t                    var ct_method = document.createElement(\"input\");\n\t                    ct_method.name = 'cleantalk_hidden_method';\n\t\t\t\t\t\tct_method.value = currentForm.method;\n\t\t\t\t\t\tct_method.type = 'hidden';\n\n                        currentForm.method = 'POST';\n                        currentForm.appendChild(ct_method);\n\n                        currentForm.action = document.location;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t}\n}\nfunction apbct_replace_inputs_values_from_other_form( form_source, form_target ){\n\n\tvar\tinputs_source = jQuery( form_source ).find( 'button, input, textarea, select' ),\n\t\tinputs_target = jQuery( form_target ).find( 'button, input, textarea, select' );\n\n\tinputs_source.each( function( index, elem_source ){\n\n\t\tvar source = jQuery( elem_source );\n\n\t\tinputs_target.each( function( index2, elem_target ){\n\n\t\t\tvar target = jQuery( elem_target );\n\n\t\t\tif( elem_source.outerHTML === elem_target.outerHTML ){\n\n\t\t\t\ttarget.val( source.val() );\n\t\t\t}\n\t\t});\n\t});\n\n}\nwindow.onload = function () {\n    setTimeout(function () {\n        ct_protect_external()\n    }, 1500);\n};\n\n/**\n * Checking the form integration\n */\nfunction isIntegratedForm(formObj) {\n    let formAction = formObj.action;\n\n    if(\n        formAction.indexOf('activehosted.com') !== -1 ||   // ActiveCampaign form\n        formAction.indexOf('app.convertkit.com') !== -1 || // ConvertKit form\n        ( formObj.firstChild.classList !== undefined && formObj.firstChild.classList.contains('cb-form-group') ) || // Convertbox form\n        formAction.indexOf('mailerlite.com') !== -1 // Mailerlite integration\n    ) {\n        return true;\n    }\n\n    return false;\n}\n\n/**\n * Sending Ajax for checking form data\n */\nfunction sendAjaxCheckingFormData(form, prev, formOriginal) {\n    // Get visible fields and set cookie\n    var visible_fields = {};\n    visible_fields[0] = apbct_collect_visible_fields(form);\n    apbct_visible_fields_set_cookie( visible_fields );\n\n    var data = {};\n    var elems = form.elements;\n    elems = Array.prototype.slice.call(elems);\n\n    elems.forEach( function( elem, y ) {\n        if( elem.name === '' ) {\n            data['input_' + y] = elem.value;\n        } else {\n            data[elem.name] = elem.value;\n        }\n    });\n\n    apbct_public_sendAJAX(\n        data,\n        {\n            async: false,\n            callback: function( prev, formOriginal, result ){\n\n                if( ! +result.apbct.blocked ) {\n\n                    let form_new = jQuery(form).detach();\n\n                    apbct_replace_inputs_values_from_other_form(form_new, formOriginal);\n\n                    prev.after( formOriginal );\n\n                    // Common click event\n                    let subm_button = jQuery(formOriginal).find('button[type=submit]');\n                    if( subm_button.length !== 0 ) {\n                        subm_button[0].click();\n                    }\n\n                    // ConvertKit direct integration\n                    subm_button = jQuery(formOriginal).find('button[data-element=\"submit\"]');\n                    if( subm_button.length !== 0 ) {\n                        subm_button[0].click();\n                    }\n\n                }\n            },\n            callback_context: null,\n            callback_params: [prev, formOriginal],\n        }\n    );\n}\n"],"names":["ct_protect_external","i","document","forms","length","undefined","cleantalk_hidden_action","cleantalk_hidden_method","currentForm","isIntegratedForm","jQuery","before","prev","form_html","outerHTML","form_original","detach","after","force_action","createElement","name","value","type","reUseCurrentForm","appendChild","classList","contains","mailerliteSubmitButton","find","click","event","preventDefault","sendAjaxCheckingFormData","onsubmit","ct_method","action","indexOf","split","toLowerCase","location","hostname","ct_action","method","apbct_replace_inputs_values_from_other_form","form_source","form_target","inputs_source","inputs_target","each","index","elem_source","source","index2","elem_target","target","val","formObj","formAction","firstChild","form","formOriginal","visible_fields","apbct_collect_visible_fields","apbct_visible_fields_set_cookie","data","elems","elements","Array","prototype","slice","call","forEach","elem","y","apbct_public_sendAJAX","async","callback","result","apbct","blocked","subm_button","callback_context","callback_params","window","onload","setTimeout"],"mappings":"AAGA,SAASA,sBACR,IAAI,IAAIC,EAAI,EAAGA,EAAIC,SAASC,MAAMC,OAAQH,IAEzC,QAAkDI,IAA9CH,SAASC,MAAMF,GAAGK,8BAAuFD,IAA9CH,SAASC,MAAMF,GAAGM,wBAAuC,CAG9G,IAAIC,EAAcN,SAASC,MAAMF,GAE1C,GAAiC,iBAAvBO,EAAkB,OAE3B,GAAGC,iBAAiBD,GAAc,CACjCE,OAAQF,GAAcG,OAAO,gEAG7B,IAAIC,EAAOF,OAAOF,GAAaI,OAC9BC,EAAYL,EAAYM,UACxBC,EAAgBL,OAAOF,GAAaQ,SAErCJ,EAAKK,MAAOJ,GAEZ,IAAIK,EAAehB,SAASiB,cAAc,SAC1CD,EAAaE,KAAO,SACpBF,EAAaG,MAAQ,6BACrBH,EAAaI,KAAO,SAEL,IAAIC,EAAmBrB,SAASC,MAAMF,GAKtC,GAHAsB,EAAiBC,YAAYN,QAGKb,IAA/BkB,EAAiBE,WAA2BF,EAAiBE,UAAUC,SAAS,iBAAkB,CACjG,MAAMC,EAAyBjB,OAAO,sBAAsBkB,KAAK,8BAEnCvB,IAA3BsB,GACCA,EAAuBE,MAAM,SAAUC,GACnCA,EAAMC,iBACNC,yBAAyBT,EAAkBX,EAAMG,UAIzDb,SAASC,MAAMF,GAAGgC,SAAW,SAAWH,GAEpCA,EAAMC,iBAENC,yBAAyBT,EAAkBX,EAAMG,QAKnE,CAAA,IAcemB,GAd+B,IAA3C1B,EAAY2B,OAAOC,QAAQ,aAAiE,IAA5C5B,EAAY2B,OAAOC,QAAQ,aAEzE5B,EAAY2B,OAAOE,MAAM,MACzB,GAAGA,MAAM,KACJ,GAAGC,gBAENC,SAASC,SAASF,iBAEVG,EAAYvC,SAASiB,cAAc,UAC7BC,KAAO,0BAChCqB,EAAUpB,MAAQb,EAAY2B,OAC9BM,EAAUnB,KAAO,SACCd,EAAYgB,YAAYiB,IAEvBP,EAAYhC,SAASiB,cAAc,UAC7BC,KAAO,0BAChCc,EAAUb,MAAQb,EAAYkC,OAC9BR,EAAUZ,KAAO,SAECd,EAAYkC,OAAS,OACrBlC,EAAYgB,YAAYU,GAExB1B,EAAY2B,OAASjC,SAASqC,YAQtD,SAASI,4CAA6CC,EAAaC,GAElE,IAAIC,EAAgBpC,OAAQkC,GAAchB,KAAM,mCAC/CmB,EAAgBrC,OAAQmC,GAAcjB,KAAM,mCAE7CkB,EAAcE,KAAM,SAAUC,EAAOC,GAEpC,IAAIC,EAASzC,OAAQwC,GAErBH,EAAcC,KAAM,SAAUI,EAAQC,GAErC,IAAIC,EAAS5C,OAAQ2C,GAEjBH,EAAYpC,YAAcuC,EAAYvC,WAEzCwC,EAAOC,IAAKJ,EAAOI,WAevB,SAAS9C,iBAAiB+C,GACtB,IAAIC,EAAaD,EAAQrB,OAEzB,UACgD,IAA5CsB,EAAWrB,QAAQ,sBAC2B,IAA9CqB,EAAWrB,QAAQ,4BACgB/B,IAAjCmD,EAAQE,WAAWjC,WAA2B+B,EAAQE,WAAWjC,UAAUC,SAAS,mBAC5C,IAA1C+B,EAAWrB,QAAQ,mBAW3B,SAASJ,yBAAyB2B,EAAM/C,EAAMgD,GAE1C,IAAIC,EAAiB,GACrBA,EAAe,GAAKC,6BAA6BH,GACjDI,gCAAiCF,GAEjC,IAAIG,EAAO,GACPC,EAAQN,EAAKO,UACjBD,EAAQE,MAAMC,UAAUC,MAAMC,KAAKL,IAE7BM,QAAS,SAAUC,EAAMC,GACT,KAAdD,EAAKpD,KACL4C,EAAK,SAAWS,GAAKD,EAAKnD,MAE1B2C,EAAKQ,EAAKpD,MAAQoD,EAAKnD,QAI/BqD,sBACIV,EACA,CACIW,OAAO,EACPC,SAAU,SAAUhE,EAAMgD,EAAciB,GAEpC,KAAOA,EAAOC,MAAMC,QAAU,CAI1BpC,4CAFejC,OAAOiD,GAAM3C,SAE0B4C,GAEtDhD,EAAKK,MAAO2C,GAGZ,IAAIoB,EAActE,OAAOkD,GAAchC,KAAK,uBACjB,IAAvBoD,EAAY5E,QACZ4E,EAAY,GAAGnD,QAInBmD,EAActE,OAAOkD,GAAchC,KAAK,iCACb,IAAvBoD,EAAY5E,QACZ4E,EAAY,GAAGnD,UAK3BoD,iBAAkB,KAClBC,gBAAiB,CAACtE,EAAMgD,KA1EpCuB,OAAOC,OAAS,WACZC,WAAW,WACPrF,uBACD"}
