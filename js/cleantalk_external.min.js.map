{"version":3,"file":"cleantalk_external.min.js","sources":["cleantalk_external.js"],"sourcesContent":["/**\n * Handle external forms\n */\nfunction ct_protect_external() {\n    for(var i = 0; i < document.forms.length; i++) {\n\n        if (document.forms[i].cleantalk_hidden_action === undefined && document.forms[i].cleantalk_hidden_method === undefined) {\n\n            // current form\n            var currentForm = document.forms[i];\n\n            if(typeof(currentForm.action) == 'string') {\n\n                if(isIntegratedForm(currentForm)) {\n                    jQuery( currentForm ).before('<i class=\"cleantalk_placeholder\" style=\"display: none;\"></i>');\n\n                    // Deleting form to prevent submit event\n                    var prev = jQuery(currentForm).prev(),\n                        form_html = currentForm.outerHTML,\n                        form_original = jQuery(currentForm).detach();\n\n                    prev.after( form_html );\n\n                    var force_action = document.createElement(\"input\");\n                    force_action.name = 'action';\n                    force_action.value = 'cleantalk_force_ajax_check';\n                    force_action.type = 'hidden';\n\n                    var reUseCurrentForm = document.forms[i];\n\n                    reUseCurrentForm.appendChild(force_action);\n\n                    // mailerlite integration - disable click on submit button\n                    if(reUseCurrentForm.classList !== undefined && reUseCurrentForm.classList.contains('ml-block-form')) {\n                        var mailerliteSubmitButton = jQuery('form.ml-block-form').find('button[type=\"submit\"]');\n\n                        if(mailerliteSubmitButton !== undefined) {\n                            mailerliteSubmitButton.click(function (event) {\n                                event.preventDefault();\n                                sendAjaxCheckingFormData(reUseCurrentForm, prev, form_original);\n                            });\n                        }\n                    } else {\n                        document.forms[i].onsubmit = function ( event ){\n                            event.preventDefault();\n\n                            const prev = jQuery(event.currentTarget).prev();\n                            const form_original = jQuery(event.currentTarget).clone();\n\n                            sendAjaxCheckingFormData(event.currentTarget, prev, form_original);\n                        };\n                    }\n\n                    // Common flow\n                }else if(currentForm.action.indexOf('http://') !== -1 || currentForm.action.indexOf('https://') !== -1) {\n\n                    var tmp = currentForm.action.split('//');\n                    tmp = tmp[1].split('/');\n                    var host = tmp[0].toLowerCase();\n\n                    if(host !== location.hostname.toLowerCase()){\n\n                        var ct_action = document.createElement(\"input\");\n                        ct_action.name = 'cleantalk_hidden_action';\n                        ct_action.value = currentForm.action;\n                        ct_action.type = 'hidden';\n                        currentForm.appendChild(ct_action);\n\n                        var ct_method = document.createElement(\"input\");\n                        ct_method.name = 'cleantalk_hidden_method';\n                        ct_method.value = currentForm.method;\n                        ct_method.type = 'hidden';\n\n                        currentForm.method = 'POST';\n                        currentForm.appendChild(ct_method);\n\n                        currentForm.action = document.location;\n                    }\n                }\n            }\n        }\n\n    }\n}\nfunction apbct_replace_inputs_values_from_other_form( form_source, form_target ){\n\n    var\tinputs_source = jQuery( form_source ).find( 'button, input, textarea, select' ),\n        inputs_target = jQuery( form_target ).find( 'button, input, textarea, select' );\n\n    inputs_source.each( function( index, elem_source ){\n\n        var source = jQuery( elem_source );\n\n        inputs_target.each( function( index2, elem_target ){\n\n            var target = jQuery( elem_target );\n\n            if( elem_source.outerHTML === elem_target.outerHTML ){\n\n                target.val( source.val() );\n            }\n        });\n    });\n\n}\nwindow.onload = function () {\n    setTimeout(function () {\n        ct_protect_external()\n    }, 1500);\n};\n\n/**\n * Checking the form integration\n */\nfunction isIntegratedForm(formObj) {\n    var formAction = formObj.action;\n\n    if(\n        formAction.indexOf('activehosted.com') !== -1 ||   // ActiveCampaign form\n        formAction.indexOf('app.convertkit.com') !== -1 || // ConvertKit form\n        ( formObj.firstChild.classList !== undefined && formObj.firstChild.classList.contains('cb-form-group') ) || // Convertbox form\n        formAction.indexOf('mailerlite.com') !== -1 || // Mailerlite integration\n        formAction.indexOf('colcolmail.co.uk') !== -1 || // colcolmail.co.uk integration\n        formAction.indexOf('paypal.com') !== -1 ||\n        formAction.indexOf('infusionsoft.com') !== -1 ||\n        formAction.indexOf('webto.salesforce.com') !== -1 ||\n        formAction.indexOf('secure2.convio.net') !== -1 ||\n        formAction.indexOf('hookb.in') !== -1 ||\n        formAction.indexOf('external.url') !== -1\n    ) {\n        return true;\n    }\n\n    return false;\n}\n\n/**\n * Sending Ajax for checking form data\n */\nfunction sendAjaxCheckingFormData(form, prev, formOriginal) {\n    // Get visible fields and set cookie\n    var visible_fields = {};\n    visible_fields[0] = apbct_collect_visible_fields(form);\n    apbct_visible_fields_set_cookie( visible_fields );\n\n    var data = {};\n    var elems = form.elements;\n    elems = Array.prototype.slice.call(elems);\n\n    elems.forEach( function( elem, y ) {\n        if( elem.name === '' ) {\n            data['input_' + y] = elem.value;\n        } else {\n            data[elem.name] = elem.value;\n        }\n    });\n\n    apbct_public_sendAJAX(\n        data,\n        {\n            async: false,\n            callback: function( prev, formOriginal, result ){\n\n                if( result.apbct === undefined || ! +result.apbct.blocked ) {\n\n                    var form_new = jQuery(form).detach();\n\n                    apbct_replace_inputs_values_from_other_form(form_new, formOriginal);\n\n                    prev.after( formOriginal );\n\n                    // Common click event\n                    var subm_button = jQuery(formOriginal).find('button[type=submit]');\n                    if( subm_button.length !== 0 ) {\n                        subm_button[0].click();\n                        return;\n                    }\n\n                    subm_button = jQuery(formOriginal).find('input[type=submit]');\n                    if( subm_button.length !== 0 ) {\n                        subm_button[0].click();\n                        return;\n                    }\n\n                    // ConvertKit direct integration\n                    subm_button = jQuery(formOriginal).find('button[data-element=\"submit\"]');\n                    if( subm_button.length !== 0 ) {\n                        subm_button[0].click();\n                        return;\n                    }\n\n                    // Paypal integration\n                    subm_button = jQuery(formOriginal).find('input[type=\"image\"][name=\"submit\"]');\n                    if( subm_button.length !== 0 ) {\n                        subm_button[0].click();\n                    }\n\n                }\n            },\n            callback_context: null,\n            callback_params: [prev, formOriginal],\n        }\n    );\n}\n"],"names":["ct_protect_external","currentForm","prev","form_original","reUseCurrentForm","ct_action","ct_method","i","document","forms","length","undefined","cleantalk_hidden_action","cleantalk_hidden_method","isIntegratedForm","jQuery","before","form_html","outerHTML","detach","after","force_action","createElement","name","value","type","appendChild","classList","contains","mailerliteSubmitButton","find","click","event","preventDefault","sendAjaxCheckingFormData","onsubmit","currentTarget","clone","action","indexOf","split","toLowerCase","location","hostname","method","apbct_replace_inputs_values_from_other_form","form_source","form_target","inputs_source","inputs_target","each","index","elem_source","source","index2","elem_target","target","val","formObj","formAction","firstChild","form","formOriginal","visible_fields","data","apbct_collect_visible_fields","apbct_visible_fields_set_cookie","elems","elements","Array","prototype","slice","call","forEach","elem","y","apbct_public_sendAJAX","async","callback","result","apbct","blocked","subm_button","callback_context","callback_params","window","onload","setTimeout"],"mappings":"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"}