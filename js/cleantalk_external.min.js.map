{"version":3,"file":"cleantalk_external.min.js","sources":["cleantalk_external.js"],"sourcesContent":["/**\n * Handle external forms\n */\nfunction ct_protect_external() {\n    for(var i = 0; i < document.forms.length; i++) {\n\n        if (document.forms[i].cleantalk_hidden_action === undefined && document.forms[i].cleantalk_hidden_method === undefined) {\n\n            // current form\n            var currentForm = document.forms[i];\n\n            if (currentForm.parentElement && currentForm.parentElement.classList[0].indexOf('mewtwo') !== -1){\n                return\n            }\n\n            if(typeof(currentForm.action) == 'string') {\n\n                if(isIntegratedForm(currentForm)) {\n\n                    jQuery( currentForm ).before('<i class=\"cleantalk_placeholder\" style=\"display: none;\"></i>');\n\n                    // Deleting form to prevent submit event\n                    var prev = jQuery(currentForm).prev(),\n                        form_html = currentForm.outerHTML,\n                        form_original = jQuery(currentForm).detach();\n\n                    prev.after( form_html );\n\n                    var force_action = document.createElement(\"input\");\n                    force_action.name = 'action';\n                    force_action.value = 'cleantalk_force_ajax_check';\n                    force_action.type = 'hidden';\n\n                    var reUseCurrentForm = document.forms[i];\n\n                    reUseCurrentForm.appendChild(force_action);\n\n                    // mailerlite integration - disable click on submit button\n                    if(reUseCurrentForm.classList !== undefined && reUseCurrentForm.classList.contains('ml-block-form')) {\n                        var mailerliteSubmitButton = jQuery('form.ml-block-form').find('button[type=\"submit\"]');\n\n                        if(mailerliteSubmitButton !== undefined) {\n                            mailerliteSubmitButton.click(function (event) {\n                                event.preventDefault();\n                                sendAjaxCheckingFormData(reUseCurrentForm, prev, form_original);\n                            });\n                        }\n                    } else {\n                        document.forms[i].onsubmit = function ( event ){\n                            event.preventDefault();\n\n                            const prev = jQuery(event.currentTarget).prev();\n                            const form_original = jQuery(event.currentTarget).clone();\n\n                            sendAjaxCheckingFormData(event.currentTarget, prev, form_original);\n                        };\n                    }\n\n                    // Common flow\n                }else if(currentForm.action.indexOf('http://') !== -1 || currentForm.action.indexOf('https://') !== -1) {\n\n                    var tmp = currentForm.action.split('//');\n                    tmp = tmp[1].split('/');\n                    var host = tmp[0].toLowerCase();\n\n                    if(host !== location.hostname.toLowerCase()){\n\n                        var ct_action = document.createElement(\"input\");\n                        ct_action.name = 'cleantalk_hidden_action';\n                        ct_action.value = currentForm.action;\n                        ct_action.type = 'hidden';\n                        currentForm.appendChild(ct_action);\n\n                        var ct_method = document.createElement(\"input\");\n                        ct_method.name = 'cleantalk_hidden_method';\n                        ct_method.value = currentForm.method;\n                        ct_method.type = 'hidden';\n\n                        currentForm.method = 'POST'\n\n                        currentForm.appendChild(ct_method);\n\n                        currentForm.action = document.location;\n                    }\n                }\n            }\n        }\n\n    }\n}\nfunction apbct_replace_inputs_values_from_other_form( form_source, form_target ){\n\n    var\tinputs_source = jQuery( form_source ).find( 'button, input, textarea, select' ),\n        inputs_target = jQuery( form_target ).find( 'button, input, textarea, select' );\n\n    inputs_source.each( function( index, elem_source ){\n\n        var source = jQuery( elem_source );\n\n        inputs_target.each( function( index2, elem_target ){\n\n            var target = jQuery( elem_target );\n\n            if( elem_source.outerHTML === elem_target.outerHTML ){\n\n                target.val( source.val() );\n            }\n        });\n    });\n\n}\nwindow.onload = function () {\n    setTimeout(function () {\n        ct_protect_external()\n    }, 1500);\n};\n\n/**\n * Checking the form integration\n */\nfunction isIntegratedForm(formObj) {\n    var formAction = formObj.action;\n\n    if(\n        formAction.indexOf('activehosted.com') !== -1 ||   // ActiveCampaign form\n        formAction.indexOf('app.convertkit.com') !== -1 || // ConvertKit form\n        ( formObj.firstChild.classList !== undefined && formObj.firstChild.classList.contains('cb-form-group') ) || // Convertbox form\n        formAction.indexOf('mailerlite.com') !== -1 || // Mailerlite integration\n        formAction.indexOf('colcolmail.co.uk') !== -1 || // colcolmail.co.uk integration\n        formAction.indexOf('paypal.com') !== -1 ||\n        formAction.indexOf('infusionsoft.com') !== -1 ||\n        formAction.indexOf('webto.salesforce.com') !== -1 ||\n        formAction.indexOf('secure2.convio.net') !== -1 ||\n        formAction.indexOf('hookb.in') !== -1 ||\n        formAction.indexOf('external.url') !== -1 ||\n        formAction.indexOf('tp.media') !== -1 ||\n        formAction.indexOf('flodesk.com') !== -1\n\n    ) {\n        return true;\n    }\n\n    return false;\n}\n\n/**\n * Sending Ajax for checking form data\n */\nfunction sendAjaxCheckingFormData(form, prev, formOriginal) {\n    // Get visible fields and set cookie\n    var visible_fields = {};\n    visible_fields[0] = apbct_collect_visible_fields(form);\n    apbct_visible_fields_set_cookie( visible_fields );\n\n    var data = {};\n    var elems = form.elements;\n    elems = Array.prototype.slice.call(elems);\n\n    elems.forEach( function( elem, y ) {\n        if( elem.name === '' ) {\n            data['input_' + y] = elem.value;\n        } else {\n            data[elem.name] = elem.value;\n        }\n    });\n\n    apbct_public_sendAJAX(\n        data,\n        {\n            async: false,\n            callback: function( prev, formOriginal, result ){\n\n                if( result.apbct === undefined || ! +result.apbct.blocked ) {\n\n                    var form_new = jQuery(form).detach();\n\n                    apbct_replace_inputs_values_from_other_form(form_new, formOriginal);\n\n                    prev.after( formOriginal );\n\n                    // Common click event\n                    var subm_button = jQuery(formOriginal).find('button[type=submit]');\n                    if( subm_button.length !== 0 ) {\n                        subm_button[0].click();\n                        return;\n                    }\n\n                    subm_button = jQuery(formOriginal).find('input[type=submit]');\n                    if( subm_button.length !== 0 ) {\n                        subm_button[0].click();\n                        return;\n                    }\n\n                    // ConvertKit direct integration\n                    subm_button = jQuery(formOriginal).find('button[data-element=\"submit\"]');\n                    if( subm_button.length !== 0 ) {\n                        subm_button[0].click();\n                        return;\n                    }\n\n                    // Paypal integration\n                    subm_button = jQuery(formOriginal).find('input[type=\"image\"][name=\"submit\"]');\n                    if( subm_button.length !== 0 ) {\n                        subm_button[0].click();\n                    }\n\n                }\n            },\n            callback_context: null,\n            callback_params: [prev, formOriginal],\n        }\n    );\n}\n"],"names":["ct_protect_external","i","document","forms","length","undefined","cleantalk_hidden_action","cleantalk_hidden_method","prev","form_original","reUseCurrentForm","ct_action","ct_method","currentForm","parentElement","classList","indexOf","isIntegratedForm","jQuery","before","form_html","outerHTML","detach","after","force_action","createElement","name","value","type","appendChild","contains","mailerliteSubmitButton","find","click","event","preventDefault","sendAjaxCheckingFormData","onsubmit","currentTarget","clone","action","split","toLowerCase","location","hostname","method","apbct_replace_inputs_values_from_other_form","form_source","form_target","inputs_source","inputs_target","each","index","elem_source","source","index2","elem_target","target","val","formObj","formAction","firstChild","form","formOriginal","visible_fields","data","apbct_collect_visible_fields","apbct_visible_fields_set_cookie","elems","elements","Array","prototype","slice","call","forEach","elem","y","apbct_public_sendAJAX","async","callback","result","apbct","blocked","subm_button","callback_context","callback_params","window","onload","setTimeout"],"mappings":"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"}