{"version":3,"file":"cleantalk-comments-editscreen.min.js","sources":["cleantalk-comments-editscreen.js"],"sourcesContent":["function ct_is_email(str){\n\treturn str.search(/.*@.*\\..*/);\n}\nfunction ct_is_ip(str){\n\treturn str.search(/^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$/);\n}\n\n/**\n * Shows a popup The Real Person when hovering over the cursor for Admin\n * @param {string} id\n */\n// todo this code is duplicated from public 2\n// eslint-disable-next-line no-unused-vars,require-jsdoc\nfunction apbctRealUserBadgeViewPopup(id) {\n    document.querySelectorAll('.apbct-admin-real-user-popup').forEach((el) => {\n        el.style.display = 'none';\n    });\n    let popup = document.getElementById(id);\n    if (popup !== undefined) {\n        popup.style.display = 'inline-flex';\n    }\n}\n/**\n * Hide a popup The Real Person when hovering over the cursor for Admin\n * @param {Event} event\n */\n// todo this code is duplicated from public 2\nfunction apbctRealUserBadgeClosePopup(event) {\n\tlet doHide = (\n\t\tevent.relatedTarget !== null &&\n\t\tevent.relatedTarget.className !== undefined &&\n\t\tevent.relatedTarget.className.search(/apbct/) === -1 &&\n\t\tevent.relatedTarget.className.search(/real/) === -1\n\t);\n\tif ( doHide ) {\n\t\tdocument.querySelectorAll('.apbct-admin-real-user-popup').forEach((el) => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tel.style.display = 'none';\n\t\t\t}, 500);\n\t\t});\n\t}\n}\n\n/**\n * Handle real user badge\n */\nfunction apbctRealUserBadge() {\n    document.querySelectorAll('.apbct-admin-real-user-badge').forEach((el) => {\n        el.addEventListener('click', function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n\t\t\tconst screenWidth = window.screen.width\n\t\t\tif (screenWidth > 768) {\n\t\t\t\te.currentTarget.querySelector('.apbct-trp-popup-desktop').style.display = 'inline-flex';\n\t\t\t} else {\n            \te.target.parentElement.parentElement.querySelector('.apbct-trp-popup-mob').style.display = 'inline-flex';\n\t\t\t}\n        });\n    });\n    document.querySelector('body').addEventListener('click', function(e) {\n        document.querySelectorAll('.apbct-admin-real-user-popup').forEach((el) => {\n            el.style.display = 'none';\n        });\n    });\n}\n\njQuery(document).ready(function(){\n    apbctRealUserBadge();\n\t/* Shows link to blacklists near every email and IP address */\n\tif(parseInt(ctCommentsScreen.ct_show_check_links))\n\t\tjQuery('.column-author a, .comment-author a').each(function(){\n\t\t\tvar ct_curr_str = jQuery(this).html();\n\t\t\tif(ct_is_email(ct_curr_str) != -1 || ct_is_ip(ct_curr_str) != -1){\n\t\t\t\tjQuery(this).after('&nbsp;<a href=\"https://cleantalk.org/blacklists/'+ct_curr_str+'\" target=\"_blank\" title=\"https://cleantalk.org/blacklists/'+ct_curr_str+'\" class=\"ct_link_new_tab\"><img src=\"'+ctCommentsScreen.ct_img_src_new_tab+'\"></a>');\n\t\t\t}\n\t\t});\n\n\t/* Feedback for comments */\n\tvar ct_comment_id;\n\n\t// For approved\n\tjQuery('span.approve').on('click', function(){\n\t\tvar result = jQuery(this).children('a').attr('href');\n\t\tresult = result.match(/^comment\\.php\\?.*c=(\\d*).*/);\n\t\tct_comment_id = result[1];\n\t\tundo_comment_id = ct_comment_id;\n\t\tct_send_feedback_request(ct_comment_id, 'approve', 0);\n\t});\n\n\t// For unapprove\n\tjQuery('span.unapprove').on('click', function(){\n\t\tvar result = jQuery(this).children('a').attr('href');\n\t\tresult = result.match(/^comment\\.php\\?.*c=(\\d*).*/);\n\t\tct_comment_id = result[1];\n\t\tundo_comment_id = ct_comment_id;\n\t\tct_send_feedback_request(ct_comment_id, 'spam', 0);\n\t});\n\n\t// For spammed\n\tjQuery('span.spam').on('click', function(){\n\t\tvar result = jQuery(this).children('a').attr('href');\n\t\tresult = result.match(/^comment\\.php\\?.*c=(\\d*).*/);\n\t\tct_comment_id = result[1];\n\t\tundo_comment_id = ct_comment_id;\n\t\tct_send_feedback_request(ct_comment_id, 'spam', 0);\n\t\tsetTimeout(function(){\n\t\t\tlet textSpans = document.querySelectorAll('div.spam-undo-inside');\n\t\t\tfor (let i = 0; i < textSpans.length; i++) {\n\t\t\t\ttextSpans[i].innerHTML = textSpans[i].innerHTML.replace(/The Real Person![*\\s\\S]*Anti-Spam by CleanTalk\\./, '');\n\t\t\t}\n\t\t\tjQuery('tr#undo-'+ct_comment_id+' span.unspam a').click(function(){\n\t\t\t\tvar result = jQuery(this).attr('href');\n\t\t\t\tresult = result.match(/^comment\\.php\\?.*&c=(\\d*).*/);\n\t\t\t\tct_comment_id = result[1];\n\t\t\t\tct_send_feedback_request(ct_comment_id, 'approve', 1);\n\t\t\t});\n\t\t}, 202);\n\t});\n\n\t// For unspammed\n\tjQuery('span.unspam').on('click', function(){\n\t\tvar result = jQuery(this).children('a').attr('href');\n\t\tresult = result.match(/^comment\\.php\\?.*c=(\\d*).*/);\n\t\tct_comment_id = result[1];\n\t\tct_send_feedback_request(ct_comment_id, 'approve', 0);\n\t});\n\n\t// For untrashed\n\tjQuery('span.untrash a').on('click', function(){\n\t\tvar result = jQuery(this).attr('href');\n\t\tresult = result.match(/^comment\\.php\\?.*c=(\\d*).*/);\n\t\tct_comment_id = result[1];\n\t\tfeedback_result = ct_send_feedback_request(ct_comment_id, 'approve', 0);\n\t});\n});\n\n// Send feedback to backend\nfunction ct_send_feedback_request(ct_comment_id, ct_comment_status, ct_undo){\n\n\tvar data = {\n\t\t'action': 'ct_feedback_comment',\n\t\t'security': ctCommentsScreen.ct_ajax_nonce,\n\t\t'comment_id': ct_comment_id,\n\t\t'comment_status': ct_comment_status\n\t};\n\n\tjQuery.ajax({\n\t\ttype: \"POST\",\n\t\turl: ajaxurl,\n\t\tdata: data,\n\t\tsuccess: function(msg){\n\t\t\tct_feedback_message_output(ct_comment_id, ct_comment_status, msg, ct_undo);\n\t\t},\n        error: function(jqXHR, textStatus, errorThrown) {\n\t\t\tconsole.log(jqXHR);\n\t\t\tconsole.log(textStatus);\n\t\t\tconsole.log(errorThrown);\n\t\t},\n        timeout: 5000\n\t});\n}\n\n// Outputs CT message about feedback\nfunction ct_feedback_message_output(ct_comment_id, ct_comment_status, ct_result, ct_undo){\n\tif(ct_result == 1){\n\t\tif(ct_comment_status == 'approve' && !ct_undo){\n\t\t\tjQuery('tr#comment-'+ct_comment_id)\n\t\t\t\t.html('')\n\t\t\t\t.show()\n\t\t\t\t.append(\"<td colspan='5'></td>\").children('td')\n\t\t\t\t\t.css('background', 'rgba(110,240,110,0.7)')\n\t\t\t\t\t.append(\"<div class='spam-undo-inside'>\"+ctCommentsScreen.ct_feedback_msg+\"</div>\");\n\t\t}\n\t\tif(ct_comment_status == 'spam'){\n\t\t\tif(jQuery('tr').is('#undo-'+ct_comment_id)){\n\t\t\t\tjQuery('tr#undo-'+ct_comment_id)\n\t\t\t\t\t.css('background', 'rgba(240,110,110,0.7)');\n\t\t\t\tjQuery('tr#undo-'+ct_comment_id+' div.spam-undo-inside')\n\t\t\t\t\t.append(\" \"+ctCommentsScreen.ct_feedback_msg);\n\t\t\t}else{\n\t\t\t\tjQuery('tr#comment-'+ct_comment_id)\n\t\t\t\t.html('')\n\t\t\t\t.show()\n\t\t\t\t.css('background', 'rgba(240,110,110,0.7)')\n\t\t\t\t.append(\"<td colspan='5'></td>\").children('td')\n\t\t\t\t\t.append(\"<div class='spam-undo-inside'>\"+ctCommentsScreen.ct_feedback_msg+\"</div>\");\n\t\t\t}\n\t\t}\n\t}\n\tif(ct_result == 0){\n\t\t// Error occurred\n\t}if(ct_result == 'no_hash'){\n\t\t// No hash for this comment\n\t}\n}\n"],"names":["ct_is_email","str","search","ct_is_ip","apbctRealUserBadgeViewPopup","id","document","querySelectorAll","forEach","el","style","display","popup","getElementById","undefined","apbctRealUserBadgeClosePopup","event","relatedTarget","className","setTimeout","apbctRealUserBadge","addEventListener","e","preventDefault","stopPropagation","window","screen","width","currentTarget","querySelector","target","parentElement","ct_send_feedback_request","ct_comment_id","ct_comment_status","ct_undo","data","action","security","ctCommentsScreen","ct_ajax_nonce","comment_id","comment_status","jQuery","ajax","type","url","ajaxurl","success","msg","ct_feedback_message_output","error","jqXHR","textStatus","errorThrown","console","log","timeout","ct_result","html","show","append","children","css","ct_feedback_msg","is","ready","parseInt","ct_show_check_links","each","ct_curr_str","this","after","ct_img_src_new_tab","on","result","attr","match","undo_comment_id","let","textSpans","i","length","innerHTML","replace","click","feedback_result"],"mappings":"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"}