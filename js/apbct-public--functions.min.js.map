{"version":3,"file":"apbct-public--functions.min.js","sources":["apbct-public--functions.js"],"sourcesContent":["function ctSetCookie( cookies, value, expires ){\n\n    if( typeof cookies === 'string' && typeof value === 'string' || typeof value === 'number'){\n        var skip_alt = cookies === 'ct_pointer_data';\n        cookies = [ [ cookies, value, expires ] ];\n    }\n\n    // Cookies disabled\n    if( ctPublicFunctions.data__cookies_type === 'none' ){\n        return;\n\n        // Using traditional cookies\n    }else if( ctPublicFunctions.data__cookies_type === 'native' ){\n        cookies.forEach( function (item, i, arr\t) {\n            var expires = typeof item[2] !== 'undefined' ? \"expires=\" + expires + '; ' : '';\n            var ctSecure = location.protocol === 'https:' ? '; secure' : '';\n            document.cookie = ctPublicFunctions.cookiePrefix + item[0] + \"=\" + encodeURIComponent(item[1]) + \"; \" + expires + \"path=/; samesite=lax\" + ctSecure;\n        });\n\n        // Using alternative cookies\n    }else if( ctPublicFunctions.data__cookies_type === 'alternative' && ! skip_alt ){\n\n        // Using REST API handler\n        if( ctPublicFunctions.data__ajax_type === 'rest' ){\n            apbct_public_sendREST(\n                'alt_sessions',\n                {\n                    method: 'POST',\n                    data: { cookies: cookies }\n                }\n            );\n\n        // Using AJAX request and handler\n        } else if( ctPublicFunctions.data__ajax_type === 'admin_ajax' ) {\n            apbct_public_sendAJAX(\n                {\n                    action: 'apbct_alt_session__save__AJAX',\n                    cookies: cookies,\n                },\n                {\n                    notJson: 1,\n                }\n            );\n        }\n    }\n}\n\nfunction ctDeleteCookie(cookieName) {\n    // Cookies disabled\n    if( ctPublicFunctions.data__cookies_type === 'none' ){\n        return;\n\n    // Using traditional cookies\n    }else if( ctPublicFunctions.data__cookies_type === 'native' ){\n\n        var ctSecure = location.protocol === 'https:' ? '; secure' : '';\n        document.cookie = cookieName + \"=\\\"\\\"; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/; samesite=lax\" + ctSecure;\n\n    // Using alternative cookies\n    }else if( ctPublicFunctions.data__cookies_type === 'alternative' ){\n        // @ToDo implement this logic\n    }\n}\n\nfunction apbct_public_sendAJAX(data, params, obj){\n\n    // Default params\n    var callback    = params.callback    || null;\n    var callback_context = params.callback_context || null;\n    var callback_params = params.callback_params || null;\n    var async = params.async || true;\n    var notJson     = params.notJson     || null;\n    var timeout     = params.timeout     || 15000;\n    var obj         = obj                || null;\n    var button      = params.button      || null;\n    var spinner     = params.spinner     || null;\n    var progressbar = params.progressbar || null;\n    var silent      = params.silent      || null;\n    var no_nonce    = params.no_nonce    || null;\n\n    if(typeof (data) === 'string') {\n        if( ! no_nonce )\n            data = data + '&_ajax_nonce=' + ctPublicFunctions._ajax_nonce;\n        data = data + '&no_cache=' + Math.random()\n    } else {\n        if( ! no_nonce )\n            data._ajax_nonce = ctPublicFunctions._ajax_nonce;\n        data.no_cache = Math.random();\n    }\n    // Button and spinner\n    if(button)  {button.setAttribute('disabled', 'disabled'); button.style.cursor = 'not-allowed'; }\n    if(spinner) jQuery(spinner).css('display', 'inline');\n\n    jQuery.ajax({\n        type: \"POST\",\n        url: ctPublicFunctions._ajax_url,\n        data: data,\n        async: async,\n        success: function(result){\n            if(button){  button.removeAttribute('disabled'); button.style.cursor = 'pointer'; }\n            if(spinner)  jQuery(spinner).css('display', 'none');\n            if(!notJson) result = JSON.parse(result);\n            if(result.error){\n                setTimeout(function(){ if(progressbar) progressbar.fadeOut('slow'); }, 1000);\n                console.log('Error happens: ' + (result.error || 'Unkown'));\n            }else{\n                if(callback) {\n                    if (callback_params)\n                        callback.apply( callback_context, callback_params.concat( result, data, params, obj ) );\n                    else\n                        callback(result, data, params, obj);\n                }\n            }\n        },\n        error: function(jqXHR, textStatus, errorThrown){\n            if(button){  button.removeAttribute('disabled'); button.style.cursor = 'pointer'; }\n            if(spinner) jQuery(spinner).css('display', 'none');\n            if( errorThrown && ! silent ) {\n                console.log('APBCT_AJAX_ERROR');\n                console.log(jqXHR);\n                console.log(textStatus);\n                console.log('Anti-spam by Cleantalk plugin error: ' + errorThrown + 'Please, contact Cleantalk tech support https://wordpress.org/support/plugin/cleantalk-spam-protect/');\n            }\n        },\n        timeout: timeout,\n    });\n}\n\nfunction apbct_public_sendREST( route, params ) {\n\n    var callback = params.callback || null;\n    var data     = params.data || [];\n    var method   = params.method || 'POST';\n\n    jQuery.ajax({\n        type: method,\n        url: ctPublicFunctions._rest_url + 'cleantalk-antispam/v1/' + route,\n        data: data,\n        beforeSend : function ( xhr ) {\n            xhr.setRequestHeader( 'X-WP-Nonce', ctPublicFunctions._rest_nonce );\n        },\n        success: function(result){\n            if(result.error){\n                console.log('Error happens: ' + (result.error || 'Unknown'));\n            }else{\n                if(callback) {\n                    var obj = null;\n                    callback(result, route, params, obj);\n                }\n            }\n        },\n        error: function(jqXHR, textStatus, errorThrown){\n            if( errorThrown ) {\n                console.log('APBCT_REST_ERROR');\n                console.log(jqXHR);\n                console.log(textStatus);\n                console.log('Anti-spam by Cleantalk plugin REST API error: ' + errorThrown + ' Please, contact Cleantalk tech support https://wordpress.org/support/plugin/cleantalk-spam-protect/');\n            }\n        },\n    });\n}\n\napbctLocalStorage = {\n    get : function(key, property) {\n        if ( typeof property === 'undefined' ) {\n            property = 'value';\n        }\n        const storageValue = localStorage.getItem(key);\n        if ( storageValue !== null ) {\n            try {\n                const json = JSON.parse(storageValue);\n                return json.hasOwnProperty(property) ? JSON.parse(json[property]) : json;\n            } catch (e) {\n                return new Error(e);\n            }\n        }\n        return false;\n    },\n    set : function(key, value) {\n        let objToSave = {'value': JSON.stringify(value), 'timestamp': Math.floor(new Date().getTime() / 1000)};\n        localStorage.setItem(key, JSON.stringify(objToSave));\n    },\n    isAlive : function(key, maxLifetime) {\n        if ( typeof maxLifetime === 'undefined' ) {\n            maxLifetime = 86400;\n        }\n        const keyTimestamp = this.get(key, 'timestamp');\n        return keyTimestamp + maxLifetime > Math.floor(new Date().getTime() / 1000);\n    },\n    isSet : function(key) {\n        return localStorage.getItem(key) !== null;\n    }\n}"],"names":["ctSetCookie","cookies","value","expires","skip_alt","ctPublicFunctions","data__cookies_type","forEach","item","i","arr","ctSecure","location","protocol","document","cookie","cookiePrefix","encodeURIComponent","data__ajax_type","apbct_public_sendREST","method","data","apbct_public_sendAJAX","action","notJson","ctDeleteCookie","cookieName","params","obj","callback","callback_context","callback_params","async","timeout","button","spinner","progressbar","silent","no_nonce","_ajax_nonce","Math","random","no_cache","setAttribute","style","cursor","jQuery","css","ajax","type","url","_ajax_url","success","result","removeAttribute","JSON","parse","error","setTimeout","fadeOut","console","log","apply","concat","jqXHR","textStatus","errorThrown","route","_rest_url","beforeSend","xhr","setRequestHeader","_rest_nonce","apbctLocalStorage","get","key","property","storageValue","localStorage","getItem","json","hasOwnProperty","e","Error","set","objToSave","stringify","timestamp","floor","Date","getTime","setItem","isAlive","maxLifetime","this","isSet"],"mappings":"AAAA,SAASA,YAAaC,EAASC,EAAOC,GAElC,IACQC,GADe,iBAAZH,GAAyC,iBAAVC,GAAuC,iBAAVA,KAC/DE,EAAuB,oBAAZH,EACfA,EAAU,CAAE,CAAEA,EAASC,EAAOC,KAIW,SAAzCE,kBAAkBC,qBAI6B,WAAzCD,kBAAkBC,mBACxBL,EAAQM,QAAS,SAAUC,EAAMC,EAAGC,GAChC,IAAIP,OAA6B,IAAZK,EAAK,GAAqB,WAAaL,EAAU,KAAO,GACzEQ,EAAiC,WAAtBC,SAASC,SAAwB,WAAa,GAC7DC,SAASC,OAASV,kBAAkBW,aAAeR,EAAK,GAAK,IAAMS,mBAAmBT,EAAK,IAAM,KAAOL,EAAU,uBAAyBQ,IAIhG,gBAAzCN,kBAAkBC,oBAA0CF,IAGxB,SAAtCC,kBAAkBa,gBAClBC,sBACI,eACA,CACIC,OAAQ,OACRC,KAAM,CAAEpB,QAASA,KAKoB,eAAtCI,kBAAkBa,iBACzBI,sBACI,CACIC,OAAQ,gCACRtB,QAASA,GAEb,CACIuB,QAAS,MAO7B,SAASC,eAAeC,GAEpB,IAMQf,EANqC,SAAzCN,kBAAkBC,qBAI6B,WAAzCD,kBAAkBC,oBAEpBK,EAAiC,WAAtBC,SAASC,SAAwB,WAAa,GAC7DC,SAASC,OAASW,EAAa,mEAAuEf,GAGhGN,kBAAkBC,oBAKhC,SAASgB,sBAAsBD,EAAMM,EAAQC,GAGzC,IAAIC,EAAcF,EAAOE,UAAe,KACpCC,EAAmBH,EAAOG,kBAAoB,KAC9CC,EAAkBJ,EAAOI,iBAAmB,KAC5CC,EAAQL,EAAOK,QAAS,EACxBR,EAAcG,EAAOH,SAAe,KACpCS,EAAcN,EAAOM,SAAe,KACpCL,EAAcA,GAAsB,KACpCM,EAAcP,EAAOO,QAAe,KACpCC,EAAcR,EAAOQ,SAAe,KACpCC,EAAcT,EAAOS,aAAe,KACpCC,EAAcV,EAAOU,QAAe,KACpCC,EAAcX,EAAOW,UAAe,KAEnB,iBAAX,EAGNjB,GADIA,EADEiB,EAECjB,EADIA,EAAO,gBAAkBhB,kBAAkBkC,aACxC,aAAeC,KAAKC,UAE5BH,IACFjB,EAAKkB,YAAclC,kBAAkBkC,aACzClB,EAAKqB,SAAWF,KAAKC,UAGtBP,IAAUA,EAAOS,aAAa,WAAY,YAAaT,EAAOU,MAAMC,OAAS,eAC7EV,GAASW,OAAOX,GAASY,IAAI,UAAW,UAE3CD,OAAOE,KAAK,CACRC,KAAM,OACNC,IAAK7C,kBAAkB8C,UACvB9B,KAAMA,EACNW,MAAOA,EACPoB,QAAS,SAASC,GACXnB,IAAUA,EAAOoB,gBAAgB,YAAapB,EAAOU,MAAMC,OAAS,WACpEV,GAAUW,OAAOX,GAASY,IAAI,UAAW,SAC/BM,EAAT7B,EACD6B,EADmBE,KAAKC,MAAMH,IACvBI,OACNC,WAAW,WAAetB,GAAaA,EAAYuB,QAAQ,SAAY,KACvEC,QAAQC,IAAI,mBAAqBR,EAAOI,OAAS,YAE9C5B,IACKE,EACAF,EAASiC,MAAOhC,EAAkBC,EAAgBgC,OAAQV,EAAQhC,EAAMM,EAAQC,IAEhFC,EAASwB,EAAQhC,EAAMM,EAAQC,KAI/C6B,MAAO,SAASO,EAAOC,EAAYC,GAC5BhC,IAAUA,EAAOoB,gBAAgB,YAAapB,EAAOU,MAAMC,OAAS,WACpEV,GAASW,OAAOX,GAASY,IAAI,UAAW,QACvCmB,IAAiB7B,IACjBuB,QAAQC,IAAI,oBACZD,QAAQC,IAAIG,GACZJ,QAAQC,IAAII,GACZL,QAAQC,IAAI,wCAA0CK,EAAc,yGAG5EjC,QAASA,IAIjB,SAASd,sBAAuBgD,EAAOxC,GAEnC,IAAIE,EAAWF,EAAOE,UAAY,KAC9BR,EAAWM,EAAON,MAAQ,GAC1BD,EAAWO,EAAOP,QAAU,OAEhC0B,OAAOE,KAAK,CACRC,KAAM7B,EACN8B,IAAK7C,kBAAkB+D,UAAY,yBAA2BD,EAC9D9C,KAAMA,EACNgD,WAAa,SAAWC,GACpBA,EAAIC,iBAAkB,aAAclE,kBAAkBmE,cAE1DpB,QAAS,SAASC,GACXA,EAAOI,MACNG,QAAQC,IAAI,mBAAqBR,EAAOI,OAAS,YAE9C5B,GAECA,EAASwB,EAAQc,EAAOxC,EADd,OAKtB8B,MAAO,SAASO,EAAOC,EAAYC,GAC3BA,IACAN,QAAQC,IAAI,oBACZD,QAAQC,IAAIG,GACZJ,QAAQC,IAAII,GACZL,QAAQC,IAAI,iDAAmDK,EAAc,4GAM7FO,kBAAoB,CAChBC,IAAM,SAASC,EAAKC,QACS,IAAbA,IACRA,EAAW,SAETC,EAAeC,aAAaC,QAAQJ,GAC1C,GAAsB,OAAjBE,EACD,IACI,MAAMG,EAAOzB,KAAKC,MAAMqB,GACxB,OAAOG,EAAKC,eAAeL,GAAYrB,KAAKC,MAAMwB,EAAKJ,IAAaI,EACtE,MAAOE,GACL,OAAO,IAAIC,MAAMD,GAGzB,OAAO,GAEXE,IAAM,SAAST,EAAKzE,GACZmF,EAAY,CAACnF,MAASqD,KAAK+B,UAAUpF,GAAQqF,UAAa/C,KAAKgD,OAAM,IAAIC,MAAOC,UAAY,MAChGZ,aAAaa,QAAQhB,EAAKpB,KAAK+B,UAAUD,KAE7CO,QAAU,SAASjB,EAAKkB,GAKpB,YAJ4B,IAAhBA,IACRA,EAAc,OAEGC,KAAKpB,IAAIC,EAAK,aACbkB,EAAcrD,KAAKgD,OAAM,IAAIC,MAAOC,UAAY,MAE1EK,MAAQ,SAASpB,GACb,OAAqC,OAA9BG,aAAaC,QAAQJ"}