{"version":3,"file":"apbct-public-bundle_int-protection.min.js","sources":["apbct-public-bundle_int-protection.js"],"sourcesContent":["/**\n * Check form as internal.\n * @param {int} currForm Current form.\n */\nfunction ctCheckInternal(currForm) {\n    //  Gathering data\n    const ctData = {};\n    const elems = currForm.elements;\n    let key;\n\n    for (key in elems) {\n        if (elems[key].type !== 'submit' &&\n            elems[key].value !== undefined &&\n            elems[key].value !== '') {\n            ctData[elems[key].name] = currForm.elements[key].value;\n        }\n    }\n    ctData.action = 'ct_check_internal';\n\n    //  AJAX Request\n    apbct_public_sendAJAX(\n        ctData,\n        {\n            url: ctPublicFunctions._ajax_url,\n            callback: function(data) {\n                if (data.success === true) {\n                    currForm.origSubmit();\n                } else {\n                    alert(data.data);\n                    return false;\n                }\n            },\n        },\n    );\n}\n\ndocument.addEventListener('DOMContentLoaded', function() {\n    let ctCurrAction = '';\n    let ctCurrForm = '';\n\n    if ( ! +ctPublic.settings__forms__check_internal ) {\n        return;\n    }\n\n    setTimeout(() => {\n        for ( let i = 0; i < document.forms.length; i++ ) {\n            if ( typeof(document.forms[i].action) == 'string' ) {\n                ctCurrForm = document.forms[i];\n                ctCurrAction = ctCurrForm.action;\n                if (\n                    ctCurrAction.indexOf('https?://') !== null && // The protocol is obligatory\n                    ctCurrAction.match(ctPublic.blog_home + '.*?\\.php') !== null && // Main check\n                    ! ctCheckInternalIsExcludedForm(ctCurrAction) // Exclude WordPress native scripts from processing\n                ) {\n                    const formClone = ctCurrForm.cloneNode(true);\n                    ctCurrForm.parentNode.replaceChild(formClone, ctCurrForm);\n\n                    formClone.origSubmit = ctCurrForm.submit;\n                    formClone.submit = null;\n\n                    formClone.addEventListener('submit', function(event) {\n                        event.preventDefault();\n                        event.stopPropagation();\n                        event.stopImmediatePropagation();\n                        ctCheckInternal(event.target);\n                        return false;\n                    });\n                }\n            }\n        }\n    }, 500);\n});\n\n/**\n * Check by action to exclude the form checking\n * @param {string} action\n * @return {boolean}\n */\nfunction ctCheckInternalIsExcludedForm(action) {\n    // An array contains forms action need to be excluded.\n    const ctInternalScriptExclusions = [\n        'wp-login.php', // WordPress login page\n        'wp-comments-post.php', // WordPress Comments Form\n    ];\n\n    return ctInternalScriptExclusions.some((item) => {\n        return action.match(new RegExp(ctPublic.blog_home + '.*' + item)) !== null;\n    });\n}\n"],"names":["ctCheckInternal","currForm","ctData","elems","elements","let","key","type","undefined","value","name","action","apbct_public_sendAJAX","url","ctPublicFunctions","_ajax_url","callback","data","success","alert","origSubmit","ctCheckInternalIsExcludedForm","some","match","RegExp","ctPublic","blog_home","item","document","addEventListener","ctCurrAction","ctCurrForm","settings__forms__check_internal","setTimeout","i","forms","length","formClone","indexOf","cloneNode","parentNode","replaceChild","submit","event","preventDefault","stopPropagation","stopImmediatePropagation","target"],"mappings":"AAIA,SAASA,gBAAgBC,GAErB,IAAMC,EAAS,GACTC,EAAQF,EAASG,SACvBC,IAAIC,EAEJ,IAAKA,KAAOH,EACgB,WAApBA,EAAMG,GAAKC,MACUC,KAAAA,IAArBL,EAAMG,GAAKG,OACU,KAArBN,EAAMG,GAAKG,QACXP,EAAOC,EAAMG,GAAKI,MAAQT,EAASG,SAASE,GAAKG,OAGzDP,EAAOS,OAAS,oBAGhBC,sBACIV,EACA,CACIW,IAAKC,kBAAkBC,UACvBC,SAAU,SAASC,GACf,GAAqB,CAAA,IAAjBA,EAAKC,QAIL,OADAC,MAAMF,EAAKA,IAAI,EACR,CAAA,EAHPhB,EAASmB,WAAW,CAK5B,CACJ,CACJ,CACJ,CA4CA,SAASC,8BAA8BV,GAOnC,MALmC,CAC/B,eACA,wBAG8BW,KAAK,GACmC,OAA/DX,EAAOY,MAAM,IAAIC,OAAOC,SAASC,UAAY,KAAOC,CAAI,CAAC,CACnE,CACL,CApDAC,SAASC,iBAAiB,mBAAoB,WAC1CxB,IAAIyB,EAAe,GACfC,EAAa,GAEV,CAACN,SAASO,iCAIjBC,WAAW,KACP,IAAM5B,IAAI6B,EAAI,EAAGA,EAAIN,SAASO,MAAMC,OAAQF,CAAC,GAAK,CAC9C,IAQcG,EAR2B,UAApC,OAAOT,SAASO,MAAMD,GAAS,SAChCH,EAAaH,SAASO,MAAMD,GAGc,QAF1CJ,EAAeC,EAAWpB,QAET2B,QAAQ,WAAW,GACwB,OAAxDR,EAAaP,MAAME,SAASC,UAAY,SAAU,GAChDL,8BAA8BS,CAAY,IAEtCO,EAAYN,EAAWQ,UAAU,CAAA,CAAI,EAC3CR,EAAWS,WAAWC,aAAaJ,EAAWN,CAAU,EAExDM,EAAUjB,WAAaW,EAAWW,OAClCL,EAAUK,OAAS,KAEnBL,EAAUR,iBAAiB,SAAU,SAASc,GAK1C,OAJAA,EAAMC,eAAe,EACrBD,EAAME,gBAAgB,EACtBF,EAAMG,yBAAyB,EAC/B9C,gBAAgB2C,EAAMI,MAAM,EACrB,CAAA,CACX,CAAC,GAGb,CACJ,EAAG,GAAG,CACV,CAAC"}